import{warn as e}from"./warn.js";import t from"vue";import n from"instantsearch.js/es";import r from"algoliasearch-helper";var i=r.SearchResults,a=r.SearchParameters;function s(s,o,u){var c,d=r(o,u),f=n(s);return f.findResultsState=function(e){var n,r;try{n=require("vue-server-renderer/basic")}catch(e){}if(!n)throw new Error("you need to install vue-server-renderer");return Promise.resolve().then(function(){var n={serverPrefetch:void 0,fetch:void 0,_base:void 0,name:"ais-ssr-root-component",router:e.$router,store:e.$store},i=e.$vnode?e.$vnode.componentOptions.Ctor.extend(n):t.component(Object.assign({},e.$options,n));(r=new i({propsData:e.$options.propsData})).$slots=e.$slots,r.$root=e.$root,r.$options.serverPrefetch=[],r.instantsearch.helper=d,r.instantsearch.mainHelper=d,r.instantsearch.mainIndex.init({instantSearchInstance:r.instantsearch,parent:null,uiState:r.instantsearch._initialUiState})}).then(function(){return function(e,t){return new Promise(function(n,r){return t(e,function(e,t){e&&r(e),n(t)})})}(r,n)}).then(function(){return function(e){return new Promise(function(t,n){e.searchOnlyWithDerivedHelpers(),e.derivedHelpers[0].on("result",function(){t()}),e.derivedHelpers.forEach(function(e){return e.on("error",function(e){n(e)})})})}(d)}).then(function(){var e={};return function e(t,n){return n(t),t.getWidgets().forEach(function(t){"ais.index"===t.$$type&&(n(t),e(t,n))})}(r.instantsearch.mainIndex,function(t){e[t.getIndexId()]=t.getResults()}),f.hydrate(e),c=Object.keys(e).map(function(t){var n=e[t],r=n._state,i=n._rawResults;return[t,{_state:Object.keys(r).reduce(function(e,t){return e[t]=r[t],e},{}),_rawResults:i}]}).reduce(function(e,t){var n=t[0],r=t[1];return e[n]=r,e},{__identifier:"stringified"}),f.getState()})},f.getState=function(){if(!c)throw new Error("You need to wait for findResultsState to finish");return c},f.__forceRender=function(e,t){var n=t.getHelper(),r=f.__initialSearchResults[t.getIndexId()];if(r){var i=r._state;n.state=i;e.render({helper:n,results:r,scopedResults:function e(t){return t.filter(function(e){return"ais.index"===e.$$type}).reduce(function(t,n){return t.concat.apply(t,[{indexId:n.getIndexId(),results:f.__initialSearchResults[n.getIndexId()],helper:n.getHelper()}].concat(e(n.getWidgets())))},[])}([t]),state:i,templatesConfig:{},createURL:function(e){var r;return f._createURL(((r={})[t.getIndexId()]=t.getWidgets().filter(function(e){return"ais.index"!==e.$$type}).reduce(function(t,r){return r.getWidgetState?r.getWidgetState(t,{searchParameters:e,helper:n}):t},{}),r))},instantSearchInstance:f,searchMetadata:{isSearchStalled:!1}})}},f.hydrate=function(t){if(t){var n="stringified"===t.__identifier?Object.keys(t).reduce(function(e,n){return"__identifier"===n?e:(e[n]=new i(new a(t[n]._state),t[n]._rawResults),e)},{}):t;f.__initialSearchResults=n,f.helper=d,f.mainHelper=d,f.mainIndex.init({instantSearchInstance:f,parent:null,uiState:f._initialUiState})}else e("The result of `findResultsState()` needs to be passed to `hydrate()`.")},f}function o(e){void 0===e&&(e={});var t=e.searchClient,n=e.indexName;if(!t||!n)throw new Error("createServerRootMixin requires `searchClient` and `indexName` in the first argument");var r=s(e,t,n);return{provide:function(){return{$_ais_ssrInstantSearchInstance:this.instantsearch}},data:function(){return{instantsearch:r}}}}export{o as createServerRootMixin};
//# sourceMappingURL=createServerRootMixin.js.map
